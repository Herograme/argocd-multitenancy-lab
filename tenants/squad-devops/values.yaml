# Argo CD Tenant - Squad DevOps
# Configurações completas para produção

crds:
  install: false

#############################################
# CONFIGURAÇÕES DO SERVER
#############################################
configs:
  params:
    server.insecure: true  # Mudar para false em produção com TLS

  # ConfigMap do Argo CD
  cm:
    url: https://argocd-squad-devops.exemplo.com

    # SSO Cloudflare - OIDC
    oidc.config: |
      name: Cloudflare
      issuer: https://<team-name>.cloudflareaccess.com
      clientID: <client-id-squad-devops>
      clientSecret: $oidc.cloudflare.clientSecret
      requestedScopes:
        - openid
        - email
        - profile
        - groups
      requestedIDTokenClaims:
        groups:
          essential: true

  # RBAC - Squad DevOps tem acesso mais amplo (administradores do cluster)
  rbac:
    policy.csv: |
      # Admins da squad DevOps - acesso total
      p, role:squad-devops-admin, applications, *, */*, allow
      p, role:squad-devops-admin, applicationsets, *, */*, allow
      p, role:squad-devops-admin, logs, get, */*, allow
      p, role:squad-devops-admin, exec, create, */*, allow
      p, role:squad-devops-admin, projects, *, *, allow
      p, role:squad-devops-admin, repositories, *, *, allow
      p, role:squad-devops-admin, clusters, *, *, allow
      p, role:squad-devops-admin, accounts, *, *, allow
      p, role:squad-devops-admin, gpgkeys, *, *, allow
      p, role:squad-devops-admin, certificates, *, *, allow

      # SRE/Operadores - acesso operacional
      p, role:squad-devops-sre, applications, get, */*, allow
      p, role:squad-devops-sre, applications, sync, */*, allow
      p, role:squad-devops-sre, applications, action/*, */*, allow
      p, role:squad-devops-sre, logs, get, */*, allow
      p, role:squad-devops-sre, exec, create, */*, allow
      p, role:squad-devops-sre, projects, get, *, allow
      p, role:squad-devops-sre, clusters, get, *, allow

      # Binding de grupos do Cloudflare para roles
      g, squad-devops-admins, role:squad-devops-admin
      g, squad-devops-sre, role:squad-devops-sre

    policy.default: ""
    scopes: "[groups, email]"

  # Secret para clientSecret do OIDC
  secret:
    extra:
      oidc.cloudflare.clientSecret: "<seu-client-secret-aqui>"

#############################################
# RECURSOS DO SERVER
#############################################
server:
  service:
    type: ClusterIP

  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi

#############################################
# CONTROLLER
#############################################
controller:
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

#############################################
# REPO SERVER
#############################################
repoServer:
  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi

#############################################
# REDIS
#############################################
redis:
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 100m
      memory: 128Mi

#############################################
# COMPONENTES DESABILITADOS
#############################################
dex:
  enabled: false  # Usando OIDC direto, não precisa do Dex

notifications:
  enabled: false  # Habilitar se quiser notificações

applicationSet:
  enabled: true  # Permitir ApplicationSets neste tenant
